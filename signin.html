<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Sign In</title>
  <link rel="icon" type="image/jpeg" href="https://uploads.onecompiler.io/446mb4fr3/446mb4taj/mka%20logo.jpeg" />
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600&display=swap" rel="stylesheet" />
  <style>
    /* Background and base styles */
    body {
      margin: 0;
      min-height: 100vh;
      font-family: 'Inter', sans-serif;
      background-image: url(https://uploads.onecompiler.io/446mb4fr3/446mb4taj/Tres-Trapi-Beach-Aruba-photo-credit-baarssen_s-Images.jpg);
      background-repeat: no-repeat;
      background-position: center;
      background-size: cover;
      display: flex;
      justify-content: center;
      align-items: flex-start;
      padding: 40px 20px;
      color: #222;
      -webkit-font-smoothing: antialiased;
      -moz-osx-font-smoothing: grayscale;
    }

    /* Main container with glassmorphism */
    .container {
      background: rgba(255 255 255 / 0.9);
      backdrop-filter: blur(15px);
      border-radius: 12px;
      width: 100%;
      max-width: 420px;
      padding: 30px 30px 40px;
      box-shadow: 0 8px 32px rgb(0 0 0 / 0.12);
    }

    h2 {
      margin: 0 0 20px 0;
      font-weight: 600;
      color: #0a2540;
      text-align: center;
      letter-spacing: 0.02em;
    }

    form {
      display: flex;
      flex-direction: column;
      gap: 15px;
    }

    input[type="text"], input[type="date"], input[type="time"], select {
      font-size: 16px;
      padding: 12px 15px;
      border-radius: 8px;
      border: 1.8px solid #ccc;
      outline-offset: 2px;
      transition: border-color 0.25s ease;
      font-family: 'Inter', sans-serif;
    }
    input[type="text"]:focus,
    input[type="date"]:focus,
    input[type="time"]:focus,
    select:focus {
      border-color: #007bff;
      outline: none;
      box-shadow: 0 0 6px rgb(0 123 255 / 0.5);
    }

    button[type="submit"] {
      cursor: pointer;
      padding: 14px 0;
      border: none;
      border-radius: 8px;
      background: linear-gradient(90deg,#4b6cb7,#182848);
      color: white;
      font-size: 18px;
      font-weight: 600;
      letter-spacing: 0.05em;
      box-shadow: 0 4px 12px rgb(75 108 183 / 0.5);
      transition: background 0.3s ease;
    }

    button[type="submit"]:disabled {
      background: #bbb;
      box-shadow: none;
      cursor: not-allowed;
    }
    button[type="submit"]:not(:disabled):hover {
      background: linear-gradient(90deg,#182848,#4b6cb7);
    }

    /* Announcement bar */
    #announcementBar {
      display: none;
      text-align: center;
      padding: 14px 20px;
      margin-bottom: 18px;
      border-radius: 8px;
      font-weight: 600;
      font-size: 1rem;
      background-color: #f7c948;
      color: #333;
      box-shadow: 0 2px 8px rgb(247 201 72 / 0.6);
      user-select: none;
    }

    /* Saved entries container */
    .saved-entries {
      margin-top: 35px;
      font-size: 15px;
      color: #0b2148;
      border-radius: 12px;
      background: rgba(255 255 255 / 0.95);
      box-shadow: 0 8px 24px rgb(0 0 0 / 0.12);
      max-height: 320px;
      overflow-y: auto;
      padding: 15px 20px;
    }
    .saved-entries h3 {
      margin-top: 0;
      font-weight: 700;
      border-bottom: 2px solid #007bff;
      padding-bottom: 8px;
    }
    .entry {
      padding: 8px 0;
      border-bottom: 1px solid #ddd;
      font-weight: 500;
      line-height: 1.28;
      user-select: none;
    }
    .entry:last-child {
      border-bottom: none;
    }

    @media (max-width: 480px) {
      .container {
        max-width: 100%;
        padding: 25px 20px 35px;
      }
    }
  </style>
</head>
<body>
  <main class="container" role="main" aria-labelledby="sign-in-title">
    <h2 id="sign-in-title">Sign In</h2>
    <div id="announcementBar" role="alert" aria-live="assertive" aria-atomic="true">Maximum capacity reached. No more sign-ins allowed.</div>

    <form id="signInForm" novalidate>
      <input type="text" id="name" placeholder="Enter your name" required autocomplete="off" aria-label="Your name" />
      <input type="date" id="date" required aria-label="Date" />
      <input type="time" id="time" required aria-label="Time" />
      <select id="activity" required aria-label="Select activity">
        <option value="" disabled selected>Select activity</option>
        <option value="Lunch Recess">Lunch Recess</option>
        <option value="CWP">CWP</option>
      </select>
      <button type="submit" aria-describedby="announcementBar">Save</button>
    </form>

    <div class="saved-entries" id="savedEntries" aria-live="polite" aria-atomic="false" aria-relevant="additions">
      <h3>Saved Sign-Ins</h3>
      <div id="entriesContainer">Loading...</div>
    </div>
  </main>

  <script src="clock.js"></script>

  <script>
    (function(){
      const form = document.getElementById('signInForm');
      const entriesContainer = document.getElementById('entriesContainer');
      const announcementBar = document.getElementById('announcementBar');
      const maxSignIns = 10;

      function resetIfNewDay(){
        const todayStr = new Date().toISOString().split('T')[0];
        const lastReset = localStorage.getItem('lastResetDate');
        if(lastReset !== todayStr){
          localStorage.removeItem('signInEntries');
          localStorage.setItem('lastResetDate', todayStr);
        }
      }

      function updateAnnouncementAndButton(entries){
        const signInsClosed = localStorage.getItem('signInsClosed') === 'true';

        if(signInsClosed){
          announcementBar.style.display = 'block';
          announcementBar.textContent = "Sign-ins are currently CLOSED.";
          form.querySelector('button[type="submit"]').disabled = true;
        } else if(entries.length >= maxSignIns){
          announcementBar.style.display = 'block';
          announcementBar.textContent = "Maximum capacity reached. No more sign-ins allowed.";
          form.querySelector('button[type="submit"]').disabled = true;
        } else{
          announcementBar.style.display = 'none';
          form.querySelector('button[type="submit"]').disabled = false;
        }
      }

      function loadEntries(){
        resetIfNewDay();

        const entries = JSON.parse(localStorage.getItem('signInEntries')) || [];
        entriesContainer.innerHTML = '';
        updateAnnouncementAndButton(entries);

        if(entries.length === 0){
          entriesContainer.innerHTML = '<p>No saved entries yet.</p>';
          return;
        }
        entries.forEach(({name, date, time, activity}) => {
          const div = document.createElement('div');
          div.className = 'entry';
          div.textContent = `${name} signed in for ${activity} on ${date} at ${time}`;
          entriesContainer.appendChild(div);
        });
      }

      form.addEventListener('submit', (e) => {
        e.preventDefault();

        const name = document.getElementById('name').value.trim();
        const date = document.getElementById('date').value;
        const time = document.getElementById('time').value;
        const activity = document.getElementById('activity').value;

        if(!name || !date || !time || !activity) return;

        const entries = JSON.parse(localStorage.getItem('signInEntries')) || [];

        if(entries.length >= maxSignIns) return;

        const signInsClosed = localStorage.getItem('signInsClosed') === 'true';
        if(signInsClosed) return;

        entries.push({name, date, time, activity});
        localStorage.setItem('signInEntries', JSON.stringify(entries));

        form.reset();
        loadEntries();
      });

      // Midnight reset check every minute
      function setupMidnightResetCheck(){
        setInterval(() => {
          const now = new Date();
          if(now.getHours() === 23 && now.getMinutes() === 59){
            localStorage.removeItem('signInEntries');
            localStorage.setItem('lastResetDate', now.toISOString().split('T')[0]);
            loadEntries();
          }
        }, 60000);
      }

      loadEntries();
      setupMidnightResetCheck();
    })();
  </script>
</body>
</html>
